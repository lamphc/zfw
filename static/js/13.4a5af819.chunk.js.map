{"version":3,"sources":["pages/Login/index.module.css","pages/Login/index.js"],"names":["module","exports","Login","this","props","values","errors","handleChange","handleSubmit","className","styles","root","mode","size","onSubmit","formItem","input","name","value","username","onChange","placeholder","error","type","password","formSubmit","submit","backHome","Item","to","Component","NewLogin","withFormik","mapPropsToValues","validationSchema","yup","shape","required","matches","a","history","location","login","status","data","description","success","setLocal","ZFW_TOKEN","token","backUrl","push","fail"],"mappings":"gFACAA,EAAOC,QAAU,CAAC,KAAO,oBAAoB,UAAY,yBAAyB,SAAW,wBAAwB,SAAW,wBAAwB,MAAQ,qBAAqB,WAAa,0BAA0B,OAAS,sBAAsB,MAAQ,uB,oTCgB7PC,E,uKAEM,IAAD,EAQHC,KAAKC,MANPC,EAFK,EAELA,OAEAC,EAJK,EAILA,OACAC,EALK,EAKLA,aAEAC,EAPK,EAOLA,aAKF,OACE,yBAAKC,UAAWC,IAAOC,MAErB,uBAAQC,KAAK,SAAb,4BAGA,uBAAYC,KAAK,OAGjB,2BACE,0BAAMC,SAAUN,GACd,yBAAKC,UAAWC,IAAOK,UACrB,2BACEN,UAAWC,IAAOM,MAClBC,KAAK,WACLC,MAAOb,EAAOc,SACdC,SAAUb,EACVc,YAAY,oCAIff,EAAOa,UAAY,yBAAKV,UAAWC,IAAOY,OAAQhB,EAAOa,UAC1D,yBAAKV,UAAWC,IAAOK,UACrB,2BACEN,UAAWC,IAAOM,MAClBC,KAAK,WACLM,KAAK,WACLL,MAAOb,EAAOmB,SACdJ,SAAUb,EACVc,YAAY,oCAIff,EAAOkB,UAAY,yBAAKf,UAAWC,IAAOY,OAAQhB,EAAOkB,UAC1D,yBAAKf,UAAWC,IAAOe,YACrB,4BAAQhB,UAAWC,IAAOgB,OAAQH,KAAK,UAAvC,mBAKJ,uBAAMd,UAAWC,IAAOiB,UACtB,sBAAMC,KAAN,KACE,kBAAC,IAAD,CAAMC,GAAG,YAAT,mE,GAxDMC,aAiEdC,EAAWC,YAAW,CAE1BC,iBAAkB,iBAAO,CAAEd,SAAU,GAAIK,SAAU,KAEnDU,iBAAkBC,MAAaC,MAAM,CACnCjB,SAAUgB,MAAaE,SAAS,wCAAUC,QAzE5B,qBAyE+C,wHAC7Dd,SAAUW,MAAaE,SAAS,kCAASC,QAzE7B,sBAyE8C,2HAE5D9B,aAAa,WAAD,4BAAE,WAAOH,EAAP,oCAAAkC,EAAA,iEAAiBnC,MAASoC,EAA1B,EAA0BA,QAASC,EAAnC,EAAmCA,SAEvCtB,EAAuBd,EAAvBc,SAAUK,EAAanB,EAAbmB,SAFN,SAKgCkB,YAAM,CAAEvB,WAAUK,aALlD,gBAKJmB,EALI,EAKJA,OAAQC,EALJ,EAKIA,KAAMC,EALV,EAKUA,YACP,MAAXF,GACF,IAAMG,QAAQD,EAAa,GAE3BE,YAASC,IAAWJ,EAAKK,QAMzB,UAAIR,EAASG,YAAb,aAAI,EAAeM,SACjBV,EAAQW,KAAKV,EAASG,KAAKM,SAE3BV,EAAQW,KAAK,kBAIf,IAAMC,KAAKP,EAAa,GAtBd,2CAAF,qDAAC,IAREb,CAiCd9B,GAEY6B","file":"static/js/13.4a5af819.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Login_root__xpMLV\",\"navHeader\":\"Login_navHeader__15hA9\",\"backHome\":\"Login_backHome__uoXiv\",\"formItem\":\"Login_formItem__2h67j\",\"input\":\"Login_input__2pNlW\",\"formSubmit\":\"Login_formSubmit__13nn8\",\"submit\":\"Login_submit__3Xx64\",\"error\":\"Login_error__WN4FS\"};","import React, { Component } from 'react'\r\nimport { Flex, WingBlank, WhiteSpace, NavBar, Toast } from 'antd-mobile'\r\n\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport styles from './index.module.css'\r\nimport { login } from '../../utils/api/user'\r\nimport { setLocal, ZFW_TOKEN } from '../../utils'\r\n\r\nimport { withFormik } from 'formik';\r\n\r\nimport * as yup from 'yup';\r\n\r\n// 验证规则：\r\nconst REG_UNAME = /^[a-zA-Z_\\d]{5,8}$/\r\nconst REG_PWD = /^[a-zA-Z_\\d]{5,12}$/\r\n\r\nclass Login extends Component {\r\n\r\n  render() {\r\n    const {\r\n      values,\r\n\r\n      errors,\r\n      handleChange,\r\n\r\n      handleSubmit,\r\n    } = this.props;\r\n    // debugger\r\n    // console.log(errors)\r\n    // console.log(this.props)\r\n    return (\r\n      <div className={styles.root}>\r\n        {/* 顶部导航 */}\r\n        <NavBar mode=\"light\">\r\n          账号登录\r\n        </NavBar>\r\n        <WhiteSpace size=\"xl\" />\r\n\r\n        {/* 登录表单 */}\r\n        <WingBlank>\r\n          <form onSubmit={handleSubmit}>\r\n            <div className={styles.formItem}>\r\n              <input\r\n                className={styles.input}\r\n                name=\"username\"\r\n                value={values.username}\r\n                onChange={handleChange}\r\n                placeholder=\"请输入账号\"\r\n              />\r\n            </div>\r\n            {/* 长度为5到8位，只能出现数字、字母、下划线 */}\r\n            {errors.username && <div className={styles.error}>{errors.username}</div>}\r\n            <div className={styles.formItem}>\r\n              <input\r\n                className={styles.input}\r\n                name=\"password\"\r\n                type=\"password\"\r\n                value={values.password}\r\n                onChange={handleChange}\r\n                placeholder=\"请输入密码\"\r\n              />\r\n            </div>\r\n            {/* 长度为5到12位，只能出现数字、字母、下划线 */}\r\n            {errors.password && <div className={styles.error}>{errors.password}</div>}\r\n            <div className={styles.formSubmit}>\r\n              <button className={styles.submit} type=\"submit\">\r\n                登 录\r\n              </button>\r\n            </div>\r\n          </form>\r\n          <Flex className={styles.backHome}>\r\n            <Flex.Item>\r\n              <Link to=\"/registe\">还没有账号，去注册~</Link>\r\n            </Flex.Item>\r\n          </Flex>\r\n        </WingBlank>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n// 返回了增强的新组件 =》基础表单处理和校验\r\nconst NewLogin = withFormik({\r\n  // 设置了状态数据 （状态数据的键 =》 input元素的name属性值对应）\r\n  mapPropsToValues: () => ({ username: '', password: '' }),\r\n  // 校验? => 对象\r\n  validationSchema: yup.object().shape({\r\n    username: yup.string().required('用户名必填！').matches(REG_UNAME, '长度为5到8位，只能出现数字、字母、下划线'),\r\n    password: yup.string().required('密码必填！').matches(REG_PWD, '长度为5到12位，只能出现数字、字母、下划线'),\r\n  }),\r\n  handleSubmit: async (values, { props: { history, location } }) => {\r\n    // 获取用户名和密码\r\n    const { username, password } = values;\r\n    // console.log(username, password)\r\n    // 调接口=》校验用户名和密码\r\n    const { status, data, description } = await login({ username, password });\r\n    if (status === 200) {\r\n      Toast.success(description, 2);\r\n      //  存储token\r\n      setLocal(ZFW_TOKEN, data.token);\r\n      // 跳转页面\r\n      // 判断是否有回跳地址\r\n      debugger\r\n      // if (location.data && location.data.backUrl) {\r\n      // ?. 等价与上边写法\r\n      if (location.data?.backUrl) {\r\n        history.push(location.data.backUrl)\r\n      } else {\r\n        history.push('/home/profile')\r\n      }\r\n\r\n    } else {\r\n      Toast.fail(description, 2)\r\n    }\r\n  }\r\n})(Login);\r\n\r\nexport default NewLogin\r\n"],"sourceRoot":""}